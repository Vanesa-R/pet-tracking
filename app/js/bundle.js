import{initializeApp}from"firebase/app";import{getFirestore}from"@firebase/firestore";import{getAuth}from"firebase/auth";const firebaseConfig={apiKey:"AIzaSyBlbGMnS8UVk3ZUrlNDgYsX0q4jLum-aWA",authDomain:"pet-tracking-79e8a.firebaseapp.com",projectId:"pet-tracking-79e8a",storageBucket:"pet-tracking-79e8a.appspot.com",messagingSenderId:"248212976670",appId:"1:248212976670:web:8fb86899b7441a291e2a0f"},app=initializeApp(firebaseConfig),db=getFirestore(app),auth=getAuth(app),formPet=async e=>{const t=document.querySelector(".form__add__pet"),a=Array.from(document.querySelectorAll(".form__pet__tab")),o=document.querySelectorAll(".detail__task"),n=document.querySelectorAll("input[name='type__pet']"),i=(document.querySelector(".control__tab .btn__submit--pet"),document.querySelector(".form__add__pet .text--success"));let s="",r="",c=[],l=[],d=[],u=[];const m={namePet:!1,typePet:!1,taskPet:!1};let p=a.findIndex((e=>e.classList.contains("tab--active")));const g=()=>{a.forEach(((e,t)=>{t===p?e.classList.add("tab--active"):e.classList.remove("tab--active")}))};p<0&&(p=0,a[p].classList.add("tab--active"),g()),t.addEventListener("click",((o,s)=>{if(o.target.classList.contains("btn__next")){if(o.preventDefault(),0==p){b(r);for(let e in c)for(let t in d)d[t]===c[e].value&&c[e].click()}1==p&&h(),p++}else if(o.target.classList.contains("btn__prev")){if(o.preventDefault(),1==p){document.querySelectorAll(".checkbox__group").forEach((e=>{e.remove()})),n.forEach((e=>{e.addEventListener("change",(e=>{d.length=0,u.length=0}))}))}if(2==p){document.querySelectorAll(".container__task--checked .group__task").forEach((e=>{e.remove()}))}p--}else if(o.target.classList.contains("btn__submit")){o.preventDefault();let n=document.querySelector("input[name='name__pet']").value,s=new Date;s=s.toLocaleDateString();let c=Math.random().toString(30);setDoc(doc(db,"pets",c),{datos:{mascota:{nombre:n,tipo:r,tareas:d,temporalizacion:u},fecha_alta:s,usuario:e}},{merge:!0}),i.textContent="¡Mascota agregada con éxito!",setTimeout((()=>{i.textContent="",t.reset(),d.length=0,u.length=0}),1600),setTimeout((()=>{a.forEach(((e,t)=>0===t&&e.classList.add("tab--active")))}),1650)}m.typePet=""!==r,m.taskPet=d.length>0,g()})),o.forEach((e=>{e.addEventListener("click",(()=>{!e.hasAttribute("open")&&o.forEach((e=>e.removeAttribute("open")))}))}));const _=(e,t)=>{let a=e[t].replace("de ","").toLowerCase().replace(" ","_");s=document.createElement("div"),s.classList.add("checkbox__group");let o=document.createElement("input");o.classList.add("input"),o.setAttribute("id",`${a}`),o.setAttribute("type","checkbox"),o.setAttribute("name",`${a}`),o.setAttribute("value",`${e[t]}`),c.push(o);let n=document.createElement("label");n.classList.add("label"),n.setAttribute("for",`${a}`),n.textContent=e[t],s.appendChild(o),s.appendChild(n)},b=e=>{let t="",a=[],n=[];switch(e){case"perro":a.push("Baño","Cepillado","Corte de pelo","Corte de uñas","Limpieza de oidos","Limpieza de ojos","Limpieza dental"),n.push("Cama","Comedero","Bebedero","Juguetes","Collar");break;case"gato":a.push("Baño","Cepillado","Corte de pelo","Corte de uñas","Limpieza de oidos","Limpieza de ojos","Limpieza dental"),n.push("Cama","Arenero","Rascador","Comedero","Bebedero","Juguetes","Collar");break;case"ave":a.push("Corte de uñas"),n.push("Jaula","Comedero","Bebedero");break;case"tortuga":a.push("Baño"),n.push("Terrario","Acuario","Comedero","Bebedero")}o.forEach((e=>{if(t=e.firstElementChild.childNodes[1].textContent,"Higiene"===t)for(let t in a)_(a,t),e.appendChild(s);let o=[...new Set(n)];if("Limpieza"===t)for(let t in o)_(o,t),e.appendChild(s)})),c.forEach((e=>{e.addEventListener("click",(t=>{if(e.checked)d.includes(t.target.value)||(d.push(t.target.value),u.push("1_semana"));else if(d.includes(t.target.value)){let e=d.indexOf(t.target.value);d.splice(e,1),u.splice(e,1)}}))}))},h=()=>{for(let e in d){let t=["1 vez a la semana","1 vez al mes","2 veces al mes","1 vez al año","2 veces al año","3 veces al año"],a=document.createElement("div");a.classList.add("group__task");let o=document.createElement("label");o.setAttribute("for",`${d[e]}`),o.textContent=`${d[e]}`;let n=document.createElement("select");n.classList.add("select"),l.push(n);for(let e in t){let a=document.createElement("option");a.setAttribute("value",`${t[e].replace(/vez |veces |al |la |a /g,"").replace(" ","_")}`),a.textContent=`${t[e]}`,n.appendChild(a)}a.appendChild(o),a.appendChild(n),document.querySelector(".container__task--checked").appendChild(a)}l.forEach(((e,t)=>{e.addEventListener("change",(e=>{u.splice(t,1,`${e.target.value}`)}))}))},f=(e,t,a)=>{regExpres.user.test(e.value)?(e.classList.remove("validate--error"),e.nextElementSibling.textContent="",m[t]=!0):(e.classList.add("validate--error"),e.nextElementSibling.textContent=a,m[t]=!1)};t.addEventListener("change",(e=>(e=>{a.forEach((t=>{let a=document.querySelector(`.btn__next[data-next="${p}"]`);switch(p){case 0:"text"===e.target.type&&f(e.target,"namePet","Escribe el nombre de tu mascota"),r="radio"===e.target.type&&e.target.value,m.namePet&&m.typePet?a.removeAttribute("disabled"):a.setAttribute("disabled","disabled");break;case 1:m.taskPet?a.removeAttribute("disabled"):a.setAttribute("disabled","disabled")}}))})(e))),n.forEach((e=>{e.addEventListener("change",(t=>{r=e.value,m.typePet=!0}))}))};import{async}from"@firebase/util";import{createUserWithEmailAndPassword,signInWithEmailAndPassword,GoogleAuthProvider,signInWithPopup}from"firebase/auth";import{doc,setDoc}from"firebase/firestore";forms.forEach((e=>{e.addEventListener("submit",(async t=>{if(t.preventDefault(),e.classList.contains("form__register")){let e=document.querySelector("#user__name").value,t=document.querySelector("#email__register"),a=document.querySelector("#password__register"),o=document.querySelector(".btn__submit--register");createUserWithEmailAndPassword(auth,t.value,a.value).then((()=>{const a=auth.currentUser.uid;newUserDDBB(a,e,t.value),closeModal()})).catch((e=>{"auth/email-already-in-use"==e.code?(o.setAttribute("disabled","disabled"),t.nextElementSibling.textContent="Existe un usuario registrado con esta dirección de correo electrónico"):t.nextElementSibling.textContent=""}))}if(e.classList.contains("form__login")){let e=document.querySelector("#email__login"),t=document.querySelector("#password__login"),a=document.querySelector(".btn__submit--login");signInWithEmailAndPassword(auth,e.value,t.value).then((e=>{closeModal()})).catch((o=>{a.setAttribute("disabled","disabled"),"auth/user-not-found"==o.code?e.nextElementSibling.textContent="La dirección de correo introducida no está asociada a ninguna cuenta":e.nextElementSibling.textContent="","auth/wrong-password"==o.code?t.nextElementSibling.textContent="La contraseña es incorrecta":t.nextElementSibling.textContent=""}))}}))}));let btnGoogle=document.querySelector(".btn--google");btnGoogle.addEventListener("click",(()=>{const e=new GoogleAuthProvider;signInWithPopup(auth,e).then((e=>{GoogleAuthProvider.credentialFromResult(e);const t=e.user;newUserDDBB(t.uid,t.displayName,t.email),closeModal()})).catch((e=>{console.log(e.message)}))}));const newUserDDBB=(e,t,a)=>{setDoc(doc(db,"users",e),{datos_personales:{nombre:t,email:a}})};import{signOut}from"firebase/auth";let btnLogout=document.querySelectorAll(".interaction__logout"),menuMobile=document.querySelector(".menu__primary");btnLogout.forEach((e=>{e.addEventListener("click",(t=>{signOut(auth).then((t=>{e.classList.contains("user__logged--out")&&e.classList.add("btn--enabled"),e.classList.contains("user__logged--in")&&e.classList.remove("btn--enabled"),menuMobile.classList.remove("menu--active"),btnMenuMobile.classList.remove("btn--enabled")})).catch((e=>{console.log(e)}))}))}));import{query,where,collection,getDocs}from"firebase/firestore";let sectionEmpty=document.querySelector(".information__pets .section__pets--empty"),section=document.querySelector(".information__pets .section__pets .container__cards"),infoPet=document.querySelector(".pet__info__show");const showPets=async e=>{const t=query(collection(db,"pets"),where("datos.usuario","==",e)),a=await getDocs(t);if(a.empty)sectionEmpty.classList.add("section__fade--in");else{let e=[];section.classList.add("section__fade--in"),a.forEach((t=>{let a=t.data();for(let t in a){let o=document.createElement("article");o.classList.add("article","card"),o.setAttribute("data-pet",`${a[t].mascota.nombre}`),e.push(o);let n=document.createElement("img");n.setAttribute("src",`/dist/assets/images/avatars/avatar-${a[t].mascota.tipo}.png`);let i=document.createElement("h3");i.classList.add("card__title","title__body--bold"),i.textContent=a[t].mascota.nombre,o.appendChild(n),o.appendChild(i),section.appendChild(o)}})),e.forEach((e=>{let t=e.dataset.pet;a.forEach((a=>{let o=a.data();for(let a in o)t===o[a].mascota.nombre&&e.addEventListener("click",(e=>{let t=document.createElement("img");t.setAttribute("src",`/dist/assets/images/avatars/avatar-${o[a].mascota.tipo}.png`);let n=document.createElement("h3");n.classList.add("card__title","title__body--bold"),n.textContent=o[a].mascota.nombre;for(let e in o[a].mascota.tareas)for(let t in o[a].mascota.temporalizacion)if(e===t){let n=[o[a].mascota.tareas[e],o[a].mascota.temporalizacion[t]];console.log(n)}infoPet.classList.add("pet__info--active"),infoPet.appendChild(t),infoPet.appendChild(n)}))}))}))}};import{onAuthStateChanged}from"firebase/auth";let btnInteraction=document.querySelectorAll(".header .interaction .btn"),btnMenuMobile=document.querySelector(".icon__menu"),informationAppLoggedOut=document.querySelector(".information__app"),informationAppLoggedIn=document.querySelector(".information__pets"),page51=document.querySelectorAll(".page-51"),warningPage51=document.querySelectorAll(".private__area__warning"),linksModal=document.querySelectorAll(".private__area__warning .link");onAuthStateChanged(auth,(e=>{e?(btnInteraction.forEach((e=>{e.classList.contains("user__logged--out")&&e.classList.remove("btn--enabled"),e.classList.contains("user__logged--in")&&(window.outerWidth>=768?(e.classList.add("btn--enabled"),btnMenuMobile.classList.remove("btn--enabled")):btnMenuMobile.classList.add("btn--enabled"))})),location.pathname.includes("index")&&(informationAppLoggedOut.classList.remove("section__fade--in"),informationAppLoggedIn.classList.add("section__fade--in"),showPets(e.uid)),location.pathname.includes("mascota")&&formPet(e.uid),page51.forEach((e=>{e.classList.remove("section--hidden")})),warningPage51.forEach((e=>{e.classList.add("section--hidden")})),menu.classList.remove("section--hidden"),showIconMenu()):(btnInteraction.forEach((e=>{e.classList.contains("user__logged--out")&&e.classList.add("btn--enabled"),e.classList.contains("user__logged--in")&&e.classList.remove("btn--enabled"),location.pathname.includes("index")&&(informationAppLoggedOut.classList.add("section__fade--in"),informationAppLoggedIn.classList.remove("section__fade--in")),page51.forEach((t=>{t.classList.add("section--hidden"),openLoginModalAutomatically(e),openModalClick(e)}))})),warningPage51.forEach((e=>{e.classList.remove("section--hidden")})))}));const openLoginModalAutomatically=e=>{setTimeout((()=>{e.classList.contains("interaction__login")&&e.click()}),2600)},openModalClick=e=>{linksModal.forEach((t=>{t.addEventListener("click",(()=>{t.classList.contains("link__login")&&e.classList.contains("interaction__login")&&e.click(),t.classList.contains("link__register")&&e.classList.contains("interaction__register")&&e.click()}))}))};